<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📊 ProRecruitment Analytics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .filter-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .filter-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .filter-label {
            font-weight: bold;
            color: #555;
        }
        
        .filter-select, .filter-input {
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 15px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: white;
        }
        
        .stat-value {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #666;
            font-size: 1em;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
        }
        
        .chart-canvas {
            max-height: 400px;
        }
        
        .insights-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .insights-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }
        
        .insight-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin-bottom: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-right: 4px solid;
        }
        
        .insight-positive { border-right-color: #28a745; }
        .insight-warning { border-right-color: #ffc107; }
        .insight-negative { border-right-color: #dc3545; }
        .insight-info { border-right-color: #17a2b8; }
        
        .insight-icon {
            font-size: 1.2em;
        }
        
        .insight-text {
            flex: 1;
            font-weight: 500;
        }
        
        .export-section {
            text-align: center;
            margin-top: 30px;
        }
        
        .export-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-group {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header fade-in">
            <h1>📊 דוחות ואנליטיקה מתקדמת</h1>
            <p>ניתוח נתונים מקצועי למערכת ProRecruitment</p>
        </div>

        <!-- Controls -->
        <div class="controls fade-in">
            <div class="filter-group">
                <div class="filter-item">
                    <label class="filter-label">תקופת זמן</label>
                    <select class="filter-select" id="timeRange">
                        <option value="7">7 ימים אחרונים</option>
                        <option value="30" selected>30 ימים אחרונים</option>
                        <option value="90">90 ימים אחרונים</option>
                        <option value="365">שנה אחרונה</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="filter-label">סוג דוח</label>
                    <select class="filter-select" id="reportType">
                        <option value="overview" selected>סקירה כללית</option>
                        <option value="candidates">מועמדים</option>
                        <option value="financial">פיננסי</option>
                        <option value="performance">ביצועים</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="filter-label">מתאריך</label>
                    <input type="date" class="filter-input" id="fromDate" value="2025-07-01">
                </div>
                <div class="filter-item">
                    <label class="filter-label">עד תאריך</label>
                    <input type="date" class="filter-input" id="toDate" value="2025-07-28">
                </div>
            </div>
            <div class="btn-group">
                <button class="btn" onclick="updateCharts()">🔄 עדכן דוחות</button>
                <button class="btn" onclick="loadRealData()">📊 טען נתונים אמיתיים</button>
                <button class="btn" onclick="generateInsights()">🧠 נתח תובנות</button>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="stats-overview fade-in">
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(45deg, #28a745, #20c997);">👤</div>
                <div class="stat-value" style="color: #28a745;" id="totalCandidates">4</div>
                <div class="stat-label">סה"כ מועמדים פעילים</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(45deg, #007bff, #0056b3);">📋</div>
                <div class="stat-value" style="color: #007bff;" id="activeOrders">4</div>
                <div class="stat-label">הזמנות פעילות</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(45deg, #ffc107, #e0a800);">💰</div>
                <div class="stat-value" style="color: #ffc107;" id="monthlyRevenue">₪68,000</div>
                <div class="stat-label">הכנסות חודשיות</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(45deg, #dc3545, #c82333);">📈</div>
                <div class="stat-value" style="color: #dc3545;" id="successRate">85%</div>
                <div class="stat-label">שיעור הצלחה</div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-grid">
            <!-- Candidates Pipeline Chart -->
            <div class="chart-container fade-in">
                <h3 class="chart-title">פאנל מועמדים לפי שלבים</h3>
                <canvas id="candidatesPipelineChart" class="chart-canvas"></canvas>
            </div>

            <!-- Revenue Chart -->
            <div class="chart-container fade-in">
                <h3 class="chart-title">מגמת הכנסות חודשית</h3>
                <canvas id="revenueChart" class="chart-canvas"></canvas>
            </div>

            <!-- Vendor Performance -->
            <div class="chart-container fade-in">
                <h3 class="chart-title">ביצועי ספקים</h3>
                <canvas id="vendorPerformanceChart" class="chart-canvas"></canvas>
            </div>

            <!-- Order Status Distribution -->
            <div class="chart-container fade-in">
                <h3 class="chart-title">התפלגות סטטוס הזמנות</h3>
                <canvas id="orderStatusChart" class="chart-canvas"></canvas>
            </div>

            <!-- Client Satisfaction -->
            <div class="chart-container fade-in">
                <h3 class="chart-title">שביעות רצון לקוחות</h3>
                <canvas id="clientSatisfactionChart" class="chart-canvas"></canvas>
            </div>

            <!-- Time to Fill -->
            <div class="chart-container fade-in">
                <h3 class="chart-title">זמן ממוצע למילוי משרה</h3>
                <canvas id="timeToFillChart" class="chart-canvas"></canvas>
            </div>
        </div>

        <!-- AI Insights -->
        <div class="insights-section fade-in">
            <h3 class="insights-title">🧠 תובנות מבוססות AI</h3>
            <div id="insightsContainer">
                <div class="insight-item insight-positive">
                    <span class="insight-icon">📈</span>
                    <span class="insight-text">שיעור ההצלחה שלך 15% מעל הממוצע בענף</span>
                </div>
                <div class="insight-item insight-info">
                    <span class="insight-icon">⏱️</span>
                    <span class="insight-text">זמן מילוי משרות קצר ב-8 ימים מהמתחרים</span>
                </div>
                <div class="insight-item insight-warning">
                    <span class="insight-icon">⚠️</span>
                    <span class="insight-text">Enterprise Solutions - חוב של ₪75,000 דורש טיפול דחוף</span>
                </div>
                <div class="insight-item insight-positive">
                    <span class="insight-icon">🏆</span>
                    <span class="insight-text">StartupNation הוא הלקוח הכי מרוצה עם דירוג 4.8/5</span>
                </div>
                <div class="insight-item insight-info">
                    <span class="insight-icon">📊</span>
                    <span class="insight-text">מומלץ להעמיק קשרים עם TechVendor - ROI הגבוה ביותר</span>
                </div>
            </div>
        </div>

        <!-- Export Section -->
        <div class="export-section fade-in">
            <h3 style="margin-bottom: 20px;">📤 ייצוא דוחות</h3>
            <button class="export-btn" onclick="exportToPDF()">📄 ייצא ל-PDF</button>
            <button class="export-btn" onclick="exportToExcel()">📊 ייצא לאקסל</button>
            <button class="export-btn" onclick="exportToCSV()">📋 ייצא ל-CSV</button>
            <button class="export-btn" onclick="scheduleReport()">📅 קבע דוח תקופתי</button>
        </div>
    </div>

    <script>
        // Global variables for charts
        let charts = {};
        
        // Sample data (will be replaced with real data)
        const sampleData = {
            candidates: {
                pipeline: {
                    labels: ['סינוק', 'ראיון ראשוני', 'ראיון טכני', 'הצעה', 'נקלט'],
                    data: [12, 8, 4, 2, 1]
                }
            },
            revenue: {
                monthly: {
                    labels: ['ינו', 'פבר', 'מרץ', 'אפר', 'מאי', 'יוני', 'יולי'],
                    data: [45000, 52000, 48000, 61000, 58000, 65000, 68000]
                }
            },
            vendors: {
                performance: {
                    labels: ['TechVendor', 'Elite IT', 'StartupTalent'],
                    ratings: [4.2, 4.8, 3.8],
                    placements: [45, 28, 22]
                }
            },
            orders: {
                status: {
                    labels: ['פעיל', 'הושלם', 'בהמתנה', 'בוטל'],
                    data: [4, 1, 1, 1]
                }
            },
            clients: {
                satisfaction: {
                    labels: ['HiTech Jerusalem', 'StartupNation', 'Enterprise Solutions'],
                    ratings: [4.5, 4.8, 3.2]
                }
            },
            timeToFill: {
                labels: ['ינו', 'פבר', 'מרץ', 'אפר', 'מאי', 'יוני', 'יולי'],
                data: [28, 25, 22, 19, 21, 18, 16]
            }
        };

        // Initialize all charts
        function initializeCharts() {
            // Candidates Pipeline Chart
            const candidatesPipelineCtx = document.getElementById('candidatesPipelineChart').getContext('2d');
            charts.candidatesPipeline = new Chart(candidatesPipelineCtx, {
                type: 'bar',
                data: {
                    labels: sampleData.candidates.pipeline.labels,
                    datasets: [{
                        label: 'מספר מועמדים',
                        data: sampleData.candidates.pipeline.data,
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(220, 53, 69, 0.8)',
                            'rgba(111, 66, 193, 0.8)'
                        ],
                        borderColor: [
                            'rgba(102, 126, 234, 1)',
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(220, 53, 69, 1)',
                            'rgba(111, 66, 193, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });

            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            charts.revenue = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: sampleData.revenue.monthly.labels,
                    datasets: [{
                        label: 'הכנסות חודשיות (₪)',
                        data: sampleData.revenue.monthly.data,
                        borderColor: 'rgba(102, 126, 234, 1)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '₪' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });

            // Vendor Performance Chart
            const vendorCtx = document.getElementById('vendorPerformanceChart').getContext('2d');
            charts.vendorPerformance = new Chart(vendorCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'ביצועי ספקים',
                        data: sampleData.vendors.performance.labels.map((label, index) => ({
                            x: sampleData.vendors.performance.ratings[index],
                            y: sampleData.vendors.performance.placements[index],
                            label: label
                        })),
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(255, 193, 7, 0.8)'
                        ],
                        borderColor: [
                            'rgba(102, 126, 234, 1)',
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)'
                        ],
                        borderWidth: 2,
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.parsed;
                                    const dataPoint = context.dataset.data[context.dataIndex];
                                    return `${dataPoint.label}: דירוג ${point.x}, ${point.y} הצבות`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'דירוג איכות'
                            },
                            min: 0,
                            max: 5
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'מספר הצבות'
                            },
                            beginAtZero: true
                        }
                    }
                }
            });

            // Order Status Chart
            const orderStatusCtx = document.getElementById('orderStatusChart').getContext('2d');
            charts.orderStatus = new Chart(orderStatusCtx, {
                type: 'doughnut',
                data: {
                    labels: sampleData.orders.status.labels,
                    datasets: [{
                        data: sampleData.orders.status.data,
                        backgroundColor: [
                            'rgba(40, 167, 69, 0.8)',
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(255, 193, 7, 0.8)',
                            'rgba(220, 53, 69, 0.8)'
                        ],
                        borderColor: [
                            'rgba(40, 167, 69, 1)',
                            'rgba(102, 126, 234, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(220, 53, 69, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Client Satisfaction Chart
            const clientSatisfactionCtx = document.getElementById('clientSatisfactionChart').getContext('2d');
            charts.clientSatisfaction = new Chart(clientSatisfactionCtx, {
                type: 'bar',
                data: {
                    labels: sampleData.clients.satisfaction.labels,
                    datasets: [{
                        label: 'דירוג שביעות רצון',
                        data: sampleData.clients.satisfaction.ratings,
                        backgroundColor: sampleData.clients.satisfaction.ratings.map(rating => 
                            rating >= 4.5 ? 'rgba(40, 167, 69, 0.8)' :
                            rating >= 4.0 ? 'rgba(255, 193, 7, 0.8)' :
                            'rgba(220, 53, 69, 0.8)'
                        ),
                        borderColor: sampleData.clients.satisfaction.ratings.map(rating => 
                            rating >= 4.5 ? 'rgba(40, 167, 69, 1)' :
                            rating >= 4.0 ? 'rgba(255, 193, 7, 1)' :
                            'rgba(220, 53, 69, 1)'
                        ),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 0.5,
                                callback: function(value) {
                                    return value + '/5';
                                }
                            }
                        }
                    }
                }
            });

            // Time to Fill Chart
            const timeToFillCtx = document.getElementById('timeToFillChart').getContext('2d');
            charts.timeToFill = new Chart(timeToFillCtx, {
                type: 'line',
                data: {
                    labels: sampleData.timeToFill.labels,
                    datasets: [{
                        label: 'ימים למילוי משרה',
                        data: sampleData.timeToFill.data,
                        borderColor: 'rgba(220, 53, 69, 1)',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value + ' ימים';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update charts with new data
        function updateCharts() {
            // Simulate data refresh
            showNotification('🔄 מעדכן דוחות...', 'info');
            
            setTimeout(() => {
                // Add some variation to the data
                Object.keys(charts).forEach(chartKey => {
                    if (charts[chartKey] && charts[chartKey].data) {
                        charts[chartKey].data.datasets.forEach(dataset => {
                            if (Array.isArray(dataset.data)) {
                                dataset.data = dataset.data.map(value => {
                                    if (typeof value === 'number') {
                                        const variation = (Math.random() - 0.5) * 0.1; // ±5% variation
                                        return Math.max(0, Math.round(value * (1 + variation)));
                                    }
                                    return value;
                                });
                            }
                        });
                        charts[chartKey].update();
                    }
                });
                
                showNotification('✅ דוחות עודכנו בהצלחה!', 'success');
            }, 1500);
        }

        // Load real data from JSON files
        async function loadRealData() {
            showNotification('📊 טוען נתונים אמיתיים...', 'info');
            
            try